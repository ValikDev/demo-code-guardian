services:
  app:
    build: .
    ports:
      - "4000:4000"
    mem_limit: 200m
    memswap_limit: 200m
    environment:
      - PORT=4000
      - QUEUE_MAX_SIZE=10
      - QUEUE_MAX_CONCURRENT=1
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:4000/health').then(r=>{process.exit(r.ok?0:1)}).catch(()=>process.exit(1))"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s
